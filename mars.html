<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Mars Weather (inSight)</title>
  <link rel="stylesheet" href="css/galactic.css">
  <link rel="stylesheet" href="css/mars-controls.css">
</head>
<body class="page mars">
  <div class="space-ambient">
    <div class="stars"></div>
    <div class="dust"></div>
    <div class="glow-orbit"></div>
  </div>
  <header class="mast">
    <div class="logo">NASA Explorer</div>
    <nav class="space-nav">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="apod.html">APOD</a></li>
        <li><a href="mars.html" class="active">Mars</a></li>
        <!-- <li><a href="epic.html">EPIC</a></li> -->
        <li><a href="neows.html">NeoWs</a></li>
        <li><a href="donki.html">DONKI</a></li>
        <li><a href="eonet.html">EONET</a></li>
        <li><a href="library.html">Library</a></li>
        <li><a href="tech.html">Tech</a></li>
        <!-- <li><a href="exoplanets.html">Exoplanets</a></li> -->
      </ul>
    </nav>
  </header>

  <main class="content">
    <section class="panel">
      <h2>Mars Weather (InSight)</h2>
      <p class="desc">Use the controls below to fetch Mars weather data per Sol (Martian day).</p>

      <div class="controls">
        <label for="sol-select">Select Sol (Martian day):</label>
        <select id="sol-select">
          <!-- Options will be populated dynamically -->
        </select>
        <button id="fetch-sol-btn">Load Data</button>
      </div>

      <div id="weather-status"></div>

      <div class="gallery" id="mars-gallery">
        <!-- Weather & rover cards will appear here -->
      </div>

    </section>
  </main>
  <footer class="foot">Mars Weather & Rover Photos • Data: NASA API</footer>

  <script>
    const API_KEY = "FdEbrFcvSp6ewQDpxTgaEDEIgNSDx6epfOIcJuAA"; // replace with your API key if you have one
    const solSelect = document.getElementById("sol-select");
    const fetchBtn = document.getElementById("fetch-sol-btn");
    const statusDiv = document.getElementById("weather-status");
    const galleryDiv = document.getElementById("mars-gallery");

    // Fetch latest available sols
    async function loadSols() {
      try {
        const response = await fetch(`https://api.nasa.gov/insight_weather/?api_key=${API_KEY}&feedtype=json&ver=1.0`);
        if (!response.ok) throw new Error("Network response was not ok");

        const data = await response.json();
        const sols = data["sol_keys"] || [];

        sols.forEach(sol => {
          const option = document.createElement("option");
          option.value = sol;
          option.textContent = `Sol ${sol}`;
          solSelect.appendChild(option);
        });

        // if (sols.length > 0) fetchWeather(sols[sols.length - 1]); // Load most recent sol by default
      } catch (err) {
        statusDiv.textContent = `Error loading Sols: ${err.message}`;
      }
    }

    // Fetch weather for selected sol
    async function fetchWeather(sol) {
      statusDiv.textContent = "Loading data...";
      galleryDiv.innerHTML = "";
      try {
        const response = await fetch(`https://api.nasa.gov/insight_weather/?api_key=${API_KEY}&feedtype=json&ver=1.0`);
        if (!response.ok) throw new Error("Network response was not ok");
        const data = await response.json();
        const solData = data[sol];
        if (!solData) throw new Error("No data for this Sol");

        statusDiv.textContent = `Weather data for Sol ${sol} (Earth date: ${solData.First_UTC.slice(0,10)})`;

        // Build card for weather
        const card = document.createElement("article");
        card.className = "card";
        card.innerHTML = `
          <h4>Mars Weather — Sol ${sol}</h4>
          <p>Temperature: ${solData.AT?.av ?? "N/A"} °C</p>
          <p>Wind Speed: ${solData.HWS?.av ?? "N/A"} m/s</p>
          <p>Pressure: ${solData.PRE?.av ?? "N/A"} Pa</p>
          <p>Season: ${solData.Season}</p>
          <p>Earth Date: ${solData.First_UTC.slice(0,10)}</p>
        `;
        galleryDiv.appendChild(card);

      } catch (err) {
        statusDiv.textContent = `Error loading data: ${err.message}`;
      }
    }

    // solSelect.addEventListener("change", () => fetchWeather(solSelect.value));
    fetchBtn.addEventListener("click", () => fetchWeather(solSelect.value));

    loadSols();
  </script>
</body> 
</html>
