<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>NeoWs — Near Earth Objects</title>
  <link rel="stylesheet" href="css/galactic.css">
</head>
<body class="page neows">
  <div class="space-ambient">
    <div class="stars"></div>
    <div class="orbit-lines"></div>
    <div class="glow-orbit"></div>
  </div>
  <header class="mast">
    <div class="logo">NASA Explorer</div>
    <nav class="space-nav">
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="apod.html">APOD</a></li>
        <li><a href="mars.html">Mars</a></li>
        <!-- <li><a href="epic.html">EPIC</a></li> -->
        <li><a href="neows.html" class="active">NeoWs</a></li>
        <li><a href="donki.html">DONKI</a></li>
        <li><a href="eonet.html">EONET</a></li>
        <li><a href="library.html">Library</a></li>
        <li><a href="tech.html">Tech</a></li>
        <!-- <li><a href="exoplanets.html">Exoplanets</a></li> -->
      </ul>
    </nav>
  </header>

  <main class="content">
    <section class="panel">
      <h2>Near-Earth Objects (NeoWs)</h2>
      <p class="desc">Check upcoming asteroids approaching Earth. Select a date range and load data from NASA’s NeoWs API.</p>

      <div class="controls">
        <label for="start-date">Start Date:</label>
        <input type="date" id="start-date">
        <label for="end-date">End Date:</label>
        <input type="date" id="end-date">
        <button id="load-btn">Load Asteroids</button>
      </div>

      <div id="status"></div>

      <div class="asteroid-list" id="asteroid-list"></div>

      <div class="pagination">
        <button id="prev-page" disabled>Prev</button>
        <span id="page-info">Page 1</span>
        <button id="next-page" disabled>Next</button>
      </div>

    </section>
  </main>
  <footer class="foot">NeoWs • Data: NASA API</footer>

  <script>
    const API_KEY = "FdEbrFcvSp6ewQDpxTgaEDEIgNSDx6epfOIcJuAA"; // replace with your API key
    const loadBtn = document.getElementById("load-btn");
    const startDateInput = document.getElementById("start-date");
    const endDateInput = document.getElementById("end-date");
    const statusDiv = document.getElementById("status");
    const asteroidList = document.getElementById("asteroid-list");
    const prevBtn = document.getElementById("prev-page");
    const nextBtn = document.getElementById("next-page");
    const pageInfo = document.getElementById("page-info");

    let asteroids = [];
    let currentPage = 1;
    const pageSize = 10;

    function renderPage(page = 1) {
      asteroidList.innerHTML = "";
      const start = (page - 1) * pageSize;
      const end = start + pageSize;
      const pageData = asteroids.slice(start, end);

      if (pageData.length === 0) {
        asteroidList.innerHTML = "<p>No asteroids found for this range.</p>";
        return;
      }

      pageData.forEach(obj => {
        const diameter = obj.estimated_diameter.kilometers.estimated_diameter_max.toFixed(3);
        const missDist = Number(obj.close_approach_data[0].miss_distance.kilometers).toLocaleString();
        const risk = obj.is_potentially_hazardous_asteroid ? "high" : "low";

        const article = document.createElement("article");
        article.className = "asteroid";
        article.innerHTML = `
          <h4>${obj.name}</h4>
          <p>Diameter: ${diameter} km</p>
          <p>Close approach: ${obj.close_approach_data[0].close_approach_date}</p>
          <p>Miss distance: ${missDist} km</p>
          <div class="risk ${risk}">Risk: ${risk.charAt(0).toUpperCase() + risk.slice(1)}</div>
        `;
        asteroidList.appendChild(article);
      });

      pageInfo.textContent = `Page ${currentPage} of ${Math.ceil(asteroids.length / pageSize)}`;
      prevBtn.disabled = currentPage === 1;
      nextBtn.disabled = currentPage >= Math.ceil(asteroids.length / pageSize);
    }

    async function fetchAsteroids() {
      const startDate = startDateInput.value;
      const endDate = endDateInput.value;
      if (!startDate || !endDate) {
        statusDiv.textContent = "Please select both start and end dates.";
        return;
      }

      statusDiv.textContent = "Loading...";
      asteroidList.innerHTML = "";
      currentPage = 1;

      try {
        const url = `https://api.nasa.gov/neo/rest/v1/feed?start_date=${startDate}&end_date=${endDate}&api_key=${API_KEY}`;
        const res = await fetch(url);
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();

        // NeoWs returns objects grouped by date
        asteroids = Object.values(data.near_earth_objects).flat();
        renderPage(currentPage);
        statusDiv.textContent = `Found ${asteroids.length} near-Earth objects.`;
      } catch (err) {
        console.error(err);
        statusDiv.textContent = `Error loading data: ${err.message}`;
      }
    }

    loadBtn.addEventListener("click", fetchAsteroids);
    prevBtn.addEventListener("click", () => { if(currentPage>1){currentPage--; renderPage(currentPage);} });
    nextBtn.addEventListener("click", () => { if(currentPage<Math.ceil(asteroids.length/pageSize)){currentPage++; renderPage(currentPage);} });

    // Set default dates: last 7 days
    const today = new Date();
    const sevenDaysAgo = new Date(today);
    sevenDaysAgo.setDate(today.getDate() - 7);
    startDateInput.value = sevenDaysAgo.toISOString().split("T")[0];
    endDateInput.value = today.toISOString().split("T")[0];
  </script>
</body>
</html>
